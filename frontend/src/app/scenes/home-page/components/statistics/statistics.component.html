<div
  class="ui container segment"
>
    <div class="ui header">
        <h2 class="center aligned header">Statistics</h2>
        <div
        class="close-icon-container"
        data-tooltip="Close"
        data-position="left center"
        >
        <i id="history-close" class="large close icon" (click)="close()"></i>
        </div>
    </div>
    <form class="ui form" [formGroup]="form">
      <div class="ui row-date">
        <div class="dates-input">
          <span>From:</span>
          <dp-date-picker
            [config]="config"
            theme="dp-material"
            formControlName="startDate"
          ></dp-date-picker>
          <span>To:</span>
          <dp-date-picker
            [config]="config"
            theme="dp-material"
            formControlName="endDate"
          ></dp-date-picker>
        </div>

        <button
          id="daterange-change"
          class="ui button primary"
          [disabled]="!form.valid"
          (click)="submit()"
        >
          Update
        </button>
      </div>
    </form>

    <div class="ui row">
      <span>Statistic field:</span>
      <div class="custom-select ui compact menu">
        <select
          [(ngModel)]="statisticField"
          class="select"
          (ngModelChange)="changeField($event)"
        >
          <option
            *ngFor="let f of fields | keys"
            [value]=+f.key
            >{{ f?.value }}</option
          >
        </select>
      </div>
    </div>

    <div class="chart-wrapper" *ngIf="chartData; else noDataText">
      <ngx-charts-line-chart
        [results]="chartData"
        [xAxis]="true"
        [yAxis]="true"
        [legend]="true"
        [xAxisTickFormatting]="dateTickFormatting"
        [yAxisTickFormatting]="statisticField !== 3 ? valueDateTickFormatting : valueTickFormatting"
        [xScaleMin]="minDate"
        [xScaleMax]="maxDate"
        [roundDomains]="true"
        [rotateXAxisTicks]="true"
        [autoScale]="false">
        <ng-template #tooltipTemplate let-model="model">
          <h4>{{ dateTickFormatting(model.name) }}</h4>
          <div class="tooltip-model">
            <span>{{ model.series }}:</span>
            <span class="last">{{ valueDateTickFormatting(model.value) }}</span>
          </div>    
        </ng-template>
        <ng-template #seriesTooltipTemplate let-model="model">
          <h4>{{ dateTickFormatting(model[0].name) }}</h4>
          <div class="tooltip-models-wrapper">
            <div *ngFor="let m of model" class="tooltip-model">
              <span><i class="tooltip-label-color" [style.background-color]="m.color"></i></span>
              <span>{{ m.series }}:</span>
              <span class="last">{{ valueDateTickFormatting(m.value) }}</span>
            </div>     
          </div>    
        </ng-template>
      </ngx-charts-line-chart>
    </div>
    <ng-template #noDataText>
      <h3 class="text-center">You had no calls during specified period</h3>
    </ng-template>
   
</div>